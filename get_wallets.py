import sys
from blockchain_parser.blockchain import Blockchain
import  blockchain_parser.blockchain as BCP
import blockchain_parser.block as B
import numpy as np
import os

from datetime import datetime


#Install the following bibs:
#https://github.com/alecalve/python-bitcoin-blockchain-parser/
#https://github.com/petertodd/python-bitcoinlib


#path do blocks
DIR = '/home/r2d2/.bitcoin/blocks/blk%05d.dat'

#address with 'suspect' withdraw: maybe a paper wallet from WG 
wallets = np.load('suspect_wallets.npy')

#remove duplicated...
ws = set(wallets)

wallets = None

selected=[]
INICIO = 1346
FIM=1481 #

for i in range( INICIO, FIM):
    print i
    for blockraw in BCP.get_blocks(DIR%i):
        bt = B.Block(blockraw)
        bh = bt.header
        print '\t',bh.timestamp.isoformat()
        for tx in bt.transactions:
            for o in tx.outputs:
                try:
                    for a in o.addresses:
                        if a.address in ws:
                            print '->',a.address
                            selected.append(a.address)
                except:
                    print 'erro de parsing...'
                            
selected = [_ for _ in set(selected)]

np.save('selected.npy',selected)


            
            
    
